<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bullet Hell 2D - v2.0</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #0a0a15;
            color: #fff;
            font-family: 'Microsoft YaHei', sans-serif;
            user-select: none;
        }
        canvas {
            display: block;
        }
        #ui {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
        }
        .hud {
            position: absolute;
            padding: 10px 20px;
            background: rgba(0,0,0,0.5);
            border-radius: 8px;
            font-weight: bold;
        }
        #score { top: 20px; left: 20px; color: #0ff; font-size: 20px; }
        #wave { top: 20px; right: 20px; color: #f0f; font-size: 18px; }
        #health {
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #health-bar {
            width: 200px;
            height: 12px;
            background: #333;
            border: 2px solid #666;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 5px;
        }
        #health-fill {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #f00, #0f0);
            transition: width 0.2s;
        }
        #game-over {
            display: none;
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            pointer-events: auto;
            z-index: 100;
        }
        #game-over h1 {
            font-size: 64px;
            color: #f55;
            text-shadow: 0 0 30px #f55;
            margin-bottom: 20px;
        }
        #game-over button {
            padding: 15px 40px;
            font-size: 24px;
            background: linear-gradient(135deg, #0ff, #08f);
            border: none;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 0 20px #0ff;
        }
        #game-over button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 40px #0ff;
        }
        #instructions {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            color: #888;
            font-size: 14px;
            text-align: center;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="ui">
        <div class="hud" id="score">SCORE: 0</div>
        <div class="hud" id="wave">WAVE: 1</div>
        <div class="hud" id="health">
            <span>SHIELD</span>
            <div id="health-bar">
                <div id="health-fill"></div>
            </div>
        </div>
        <div id="instructions">üñ±Ô∏è Èº†Ê†áÁßªÂä® | Ëá™Âä®Â∞ÑÂáª | Ë∫≤ÈÅøÁ∫¢Ëâ≤ÂºπÂπï</div>
    </div>
    
    <div id="game-over">
        <h1>GAME OVER</h1>
        <p style="font-size: 24px; margin-bottom: 30px;">FINAL SCORE: <span id="final-score">0</span></p>
        <button onclick="game.restart()">RESTART</button>
    </div>

<script>
// ==================== Ê∏∏ÊàèÈÖçÁΩÆ ====================
const CONFIG = {
    playerSpeed: 0.12,
    playerFireRate: 6,
    playerHealth: 100,
    bulletSpeed: 8,
    enemySpawnRate: 60, // Â∏ß
    colors: {
        player: '#0ff',
        playerBullet: '#ff0',
        enemy: '#f05',
        enemyBullet: '#f44',
        boss: '#f0a'
    }
};

// ==================== ÁîªÂ∏ÉÂàùÂßãÂåñ ====================
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// ==================== Ê∏∏ÊàèÂÆû‰Ωì ====================
class Player {
    constructor() {
        this.x = canvas.width / 2;
        this.y = canvas.height - 100;
        this.radius = 12;
        this.health = CONFIG.playerHealth;
        this.maxHealth = CONFIG.playerHealth;
        this.invincible = 0;
        this.targetX = this.x;
        this.targetY = this.y;
    }
    
    update(inputX, inputY) {
        this.targetX = inputX;
        this.targetY = inputY;
        
        // Âπ≥ÊªëË∑üÈöè
        this.x += (this.targetX - this.x) * CONFIG.playerSpeed;
        this.y += (this.targetY - this.y) * CONFIG.playerSpeed;
        
        // ËæπÁïåÈôêÂà∂
        this.x = Math.max(this.radius, Math.min(canvas.width - this.radius, this.x));
        this.y = Math.max(this.radius, Math.min(canvas.height - this.radius, this.y));
        
        if (this.invincible > 0) this.invincible--;
    }
    
    draw() {
        if (this.invincible > 0 && Math.floor(Date.now() / 100) % 2 === 0) return;
        
        ctx.save();
        ctx.shadowBlur = 20;
        ctx.shadowColor = CONFIG.colors.player;
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fill();
        
        // Â§ñÂúàÂÖâÁéØ
        ctx.strokeStyle = CONFIG.colors.player;
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius + 6, 0, Math.PI * 2);
        ctx.stroke();
        ctx.restore();
    }
}

class Enemy {
    constructor(x, y, type) {
        this.x = x;
        this.y = y;
        this.type = type; // 'basic', 'shooter', 'tank', 'boss'
        this.active = true;
        this.timer = 0;
        
        // Ê†πÊçÆÁ±ªÂûãËÆæÁΩÆÂ±ûÊÄß
        switch(type) {
            case 'basic':
                this.radius = 20;
                this.hp = 3;
                this.speed = 2;
                this.score = 100;
                break;
            case 'shooter':
                this.radius = 18;
                this.hp = 5;
                this.speed = 1;
                this.score = 200;
                break;
            case 'tank':
                this.radius = 30;
                this.hp = 15;
                this.speed = 0.5;
                this.score = 500;
                break;
            case 'boss':
                this.radius = 50;
                this.hp = 100;
                this.speed = 0.3;
                this.score = 2000;
                break;
        }
        this.maxHp = this.hp;
    }
    
    update(wave) {
        this.timer++;
        
        switch(this.type) {
            case 'basic':
                this.y += this.speed + wave * 0.1;
                this.x += Math.sin(this.timer * 0.02) * 2;
                break;
            case 'shooter':
                this.y += this.speed + wave * 0.05;
                // ÂèëÂ∞ÑÊâáÂΩ¢ÂºπÂπï
                if (this.timer % 90 === 0) {
                    return this.shootFan(wave);
                }
                break;
            case 'tank':
                this.y += this.speed;
                // ÂèëÂ∞ÑÁõ¥Á∫øÂºπÂπï
                if (this.timer % 120 === 0) {
                    return this.shootAim(wave);
                }
                break;
            case 'boss':
                // BOSSÂ∑¶Âè≥ÁßªÂä®
                this.x = canvas.width/2 + Math.sin(this.timer * 0.01) * 200;
                if (this.y < 150) this.y += this.speed;
                // ÂèëÂ∞ÑÂ§öÁßçÂºπÂπï
                if (this.timer % 40 === 0) {
                    return this.shootBoss(wave);
                }
                break;
        }
        
        // ÁßªÂá∫Â±èÂπï
        if (this.y > canvas.height + 100) this.active = false;
        
        return [];
    }
    
    shootFan(wave) {
        const bullets = [];
        const baseAngle = Math.PI / 2;
        const count = 3 + Math.floor(wave / 2);
        for (let i = 0; i < count; i++) {
            const angle = baseAngle + (i - count/2) * 0.3;
            bullets.push({
                x: this.x, y: this.y,
                vx: Math.cos(angle) * 4,
                vy: Math.sin(angle) * 4,
                radius: 6,
                isPlayer: false,
                color: CONFIG.colors.enemyBullet
            });
        }
        return bullets;
    }
    
    shootAim(wave) {
        return [{
            x: this.x, y: this.y,
            vx: 0, vy: 5 + wave * 0.2,
            radius: 8,
            isPlayer: false,
            color: CONFIG.colors.enemyBullet
        }];
    }
    
    shootBoss(wave) {
        const bullets = [];
        // Ëû∫ÊóãÂºπÂπï
        const angle = this.timer * 0.15;
        for (let i = 0; i < 4; i++) {
            const a = angle + i * Math.PI / 2;
            bullets.push({
                x: this.x, y: this.y,
                vx: Math.cos(a) * 3,
                vy: Math.sin(a) * 3,
                radius: 8,
                isPlayer: false,
                color: '#f0f'
            });
        }
        // Âêë‰∏ãÂºπÂπï
        if (this.timer % 80 === 0) {
            for (let i = -2; i <= 2; i++) {
                bullets.push({
                    x: this.x, y: this.y,
                    vx: i * 0.5, vy: 5,
                    radius: 6,
                    isPlayer: false,
                    color: CONFIG.colors.enemyBullet
                });
            }
        }
        return bullets;
    }
    
    draw() {
        ctx.save();
        ctx.shadowBlur = 15;
        
        switch(this.type) {
            case 'basic':
                ctx.shadowColor = '#f55';
                ctx.fillStyle = '#f55';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                break;
            case 'shooter':
                ctx.shadowColor = '#f5f';
                ctx.fillStyle = '#f5f';
                ctx.fillRect(this.x - this.radius, this.y - this.radius, 
                           this.radius * 2, this.radius * 2);
                break;
            case 'tank':
                ctx.shadowColor = '#fa5';
                ctx.fillStyle = '#fa5';
                ctx.beginPath();
                ctx.moveTo(this.x, this.y - this.radius);
                ctx.lineTo(this.x + this.radius, this.y + this.radius);
                ctx.lineTo(this.x - this.radius, this.y + this.radius);
                ctx.fill();
                break;
            case 'boss':
                ctx.shadowColor = CONFIG.colors.boss;
                ctx.fillStyle = '#500';
                ctx.strokeStyle = CONFIG.colors.boss;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
                // BOSSË°ÄÊù°
                const hpPercent = this.hp / this.maxHp;
                ctx.fillStyle = '#300';
                ctx.fillRect(this.x - 40, this.y - this.radius - 15, 80, 8);
                ctx.fillStyle = hpPercent > 0.5 ? '#0f0' : '#f00';
                ctx.fillRect(this.x - 40, this.y - this.radius - 15, 80 * hpPercent, 8);
                break;
        }
        ctx.restore();
    }
}

// ==================== Ê∏∏Êàè‰∏ªÁ±ª ====================
class Game {
    constructor() {
        this.state = 'PLAY';
        this.score = 0;
        this.wave = 1;
        this.frameCount = 0;
        
        // ËæìÂÖ•
        this.input = { x: canvas.width/2, y: canvas.height/2 };
        window.addEventListener('mousemove', e => {
            this.input.x = e.clientX;
            this.input.y = e.clientY;
        });
        
        // ÂÆû‰Ωì
        this.player = new Player();
        this.enemies = [];
        this.playerBullets = [];
        this.enemyBullets = [];
        this.particles = [];
        
        this.loop = this.loop.bind(this);
        requestAnimationFrame(this.loop);
    }
    
    restart() {
        this.state = 'PLAY';
        this.score = 0;
        this.wave = 1;
        this.frameCount = 0;
        this.player = new Player();
        this.enemies = [];
        this.playerBullets = [];
        this.enemyBullets = [];
        this.particles = [];
        document.getElementById('game-over').style.display = 'none';
        this.updateUI();
    }
    
    spawnEnemy() {
        const rate = Math.max(20, CONFIG.enemySpawnRate - this.wave * 2);
        if (this.frameCount % rate === 0) {
            const x = Math.random() * (canvas.width - 100) + 50;
            const rand = Math.random();
            let type = 'basic';
            if (rand > 0.7) type = 'shooter';
            if (rand > 0.9) type = 'tank';
            
            // BOSSÊØè5Ê≥¢
            if (this.wave % 5 === 0 && this.frameCount % 300 === 0) {
                type = 'boss';
            }
            
            this.enemies.push(new Enemy(x, -50, type));
        }
    }
    
    playerShoot() {
        if (this.frameCount % CONFIG.playerFireRate === 0) {
            // ÂèåÂèëÂ≠êÂºπ
            this.playerBullets.push({
                x: this.player.x - 15, y: this.player.y - 10,
                vx: 0, vy: -12,
                radius: 5,
                isPlayer: true,
                color: CONFIG.colors.playerBullet
            });
            this.playerBullets.push({
                x: this.player.x + 15, y: this.player.y - 10,
                vx: 0, vy: -12,
                radius: 5,
                isPlayer: true,
                color: CONFIG.colors.playerBullet
            });
        }
    }
    
    createExplosion(x, y, count, color) {
        for (let i = 0; i < count; i++) {
            const angle = Math.random() * Math.PI * 2;
            const speed = Math.random() * 4 + 1;
            this.particles.push({
                x: x, y: y,
                vx: Math.cos(angle) * speed,
                vy: Math.sin(angle) * speed,
                life: 1.0,
                color: color
            });
        }
    }
    
    update() {
        if (this.state !== 'PLAY') return;
        
        this.frameCount++;
        
        // Êõ¥Êñ∞Áé©ÂÆ∂
        this.player.update(this.input.x, this.input.y);
        this.playerShoot();
        
        // ÁîüÊàêÊïå‰∫∫
        this.spawnEnemy();
        
        // Êõ¥Êñ∞Êïå‰∫∫
        for (let i = this.enemies.length - 1; i >= 0; i--) {
            const e = this.enemies[i];
            const newBullets = e.update(this.wave);
            this.enemyBullets.push(...newBullets);
            
            if (!e.active) {
                this.enemies.splice(i, 1);
                continue;
            }
            
            // Áé©ÂÆ∂Â≠êÂºπÊâìÊïå‰∫∫
            for (let j = this.playerBullets.length - 1; j >= 0; j--) {
                const b = this.playerBullets[j];
                const dist = Math.hypot(b.x - e.x, b.y - e.y);
                
                if (dist < e.radius + b.radius) {
                    // ÂëΩ‰∏≠ÔºÅ
                    e.hp--;
                    this.createExplosion(b.x, b.y, 3, '#ff0');
                    this.playerBullets.splice(j, 1);
                    
                    if (e.hp <= 0) {
                        // Êïå‰∫∫Ê≠ª‰∫°
                        this.score += e.score;
                        this.createExplosion(e.x, e.y, 15, CONFIG.colors.enemy);
                        this.enemies.splice(i, 1);
                        
                        // Ê≥¢Ê¨°ÊèêÂçá
                        if (this.score > this.wave * 1000) {
                            this.wave++;
                        }
                        this.updateUI();
                        break;
                    }
                }
            }
        }
        
        // Êõ¥Êñ∞Áé©ÂÆ∂Â≠êÂºπ
        for (let i = this.playerBullets.length - 1; i >= 0; i--) {
            const b = this.playerBullets[i];
            b.x += b.vx;
            b.y += b.vy;
            if (b.y < -20) this.playerBullets.splice(i, 1);
        }
        
        // Êõ¥Êñ∞Êïå‰∫∫Â≠êÂºπ
        for (let i = this.enemyBullets.length - 1; i >= 0; i--) {
            const b = this.enemyBullets[i];
            b.x += b.vx;
            b.y += b.vy;
            
            // Â≠êÂºπÊâìÁé©ÂÆ∂
            if (this.player.invincible <= 0) {
                const dist = Math.hypot(b.x - this.player.x, b.y - this.player.y);
                if (dist < this.player.radius + b.radius) {
                    this.playerHit();
                    this.enemyBullets.splice(i, 1);
                    continue;
                }
            }
            
            // ÁßªÂá∫Â±èÂπï
            if (b.y > canvas.height + 20 || b.x < -20 || b.x > canvas.width + 20) {
                this.enemyBullets.splice(i, 1);
            }
        }
        
        // Áé©ÂÆ∂ÊíûÊïå‰∫∫
        if (this.player.invincible <= 0) {
            for (let e of this.enemies) {
                const dist = Math.hypot(this.player.x - e.x, this.player.y - e.y);
                if (dist < this.player.radius + e.radius) {
                    this.playerHit();
                    e.hp = 0;
                    this.createExplosion(e.x, e.y, 10, CONFIG.colors.enemy);
                }
            }
        }
        
        // Ê∏ÖÁêÜÊ≠ª‰∫°Êïå‰∫∫
        this.enemies = this.enemies.filter(e => e.hp > 0);
        
        // Êõ¥Êñ∞Á≤íÂ≠ê
        for (let i = this.particles.length - 1; i >= 0; i--) {
            const p = this.particles[i];
            p.x += p.vx;
            p.y += p.vy;
            p.life -= 0.02;
            if (p.life <= 0) this.particles.splice(i, 1);
        }
    }
    
    playerHit() {
        this.player.health -= 25;
        this.player.invincible = 120; // 2ÁßíÊó†Êïå
        this.createExplosion(this.player.x, this.player.y, 20, CONFIG.colors.player);
        this.updateUI();
        
        if (this.player.health <= 0) {
            this.state = 'GAMEOVER';
            document.getElementById('final-score').textContent = this.score;
            document.getElementById('game-over').style.display = 'flex';
        }
    }
    
    draw() {
        // Ê∏ÖÂ±è
        ctx.fillStyle = 'rgba(10, 10, 21, 0.3)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        if (this.state !== 'PLAY' && this.state !== 'GAMEOVER') return;
        
        // ÁªòÂà∂Áé©ÂÆ∂Â≠êÂºπ
        ctx.save();
        this.playerBullets.forEach(b => {
            ctx.shadowBlur = 10;
            ctx.shadowColor = b.color;
            ctx.fillStyle = b.color;
            ctx.beginPath();
            ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
            ctx.fill();
        });
        ctx.restore();
        
        // ÁªòÂà∂Êïå‰∫∫Â≠êÂºπ
        ctx.save();
        this.enemyBullets.forEach(b => {
            ctx.shadowBlur = 8;
            ctx.shadowColor = b.color;
            ctx.fillStyle = b.color;
            ctx.beginPath();
            ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
            ctx.fill();
        });
        ctx.restore();
        
        // ÁªòÂà∂Êïå‰∫∫
        this.enemies.forEach(e => e.draw());
        
        // ÁªòÂà∂Áé©ÂÆ∂
        this.player.draw();
        
        // ÁªòÂà∂Á≤íÂ≠ê
        this.particles.forEach(p => {
            ctx.globalAlpha = p.life;
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
            ctx.fill();
        });
        ctx.globalAlpha = 1;
    }
    
    updateUI() {
        document.getElementById('score').textContent = `SCORE: ${this.score}`;
        document.getElementById('wave').textContent = `WAVE: ${this.wave}`;
        const hpPercent = Math.max(0, this.player.health / this.player.maxHealth * 100);
        document.getElementById('health-fill').style.width = `${hpPercent}%`;
    }
    
    loop() {
        this.update();
        this.draw();
        requestAnimationFrame(this.loop);
    }
}

// ÂêØÂä®Ê∏∏Êàè
const game = new Game();
game.updateUI();

</script>
</body>
</html>